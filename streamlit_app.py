import streamlit as st
from supabase import create_client
from datetime import datetime

# ===============================
# Supabase æ¥ç¶š
# ===============================
SUPABASE_URL = "https://wjhduisifyrxcligcpgp.supabase.co"
SUPABASE_KEY = "sb_publishable_Ayqc92-KV4eNBsupv7gYiQ_mcnIXXT2"
supabase = create_client(supabase_url, supabase_key)

# ===============================
# ãƒšãƒ¼ã‚¸è¨­å®š
# ===============================
st.set_page_config(page_title="æ”»æ’ƒèªå¤‰æ›ã‚¢ãƒ—ãƒªï¼ˆè¶…æ‹¡å¼µè¾æ›¸ç‰ˆï¼‰")
st.title("ğŸ›¡ï¸ æ”»æ’ƒèªå¤‰æ›ã‚¢ãƒ—ãƒªï¼ˆè¾æ›¸å¤§å¹…æ‹¡å¼µãƒ»å±¥æ­´ä¿å­˜ï¼‰")

# ===============================
# æ”»æ’ƒèª â†’ ä¸­ç«‹èª è¾æ›¸ï¼ˆå®Œå…¨çµ±åˆç‰ˆï¼‰
# ã²ã‚‰ãŒãª / ã‚«ã‚¿ã‚«ãƒŠ / æ¼¢å­— / ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°å¯¾å¿œ
# ===============================
replace_dict = {
    # ===== é¦¬é¹¿ãƒ»é˜¿å‘† =====
    "ã°ã‹": "è€ƒãˆãŒè¶³ã‚Šãªã„",
    "ãƒã‚«": "è€ƒãˆãŒè¶³ã‚Šãªã„",
    "é¦¬é¹¿": "è€ƒãˆãŒè¶³ã‚Šãªã„",
    "ã°ã‹ã‚„ã‚ã†": "è¨€ã„æ–¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™",
    "ãƒã‚«ãƒ¤ãƒ­ã‚¦": "è¨€ã„æ–¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™",
    "é¦¬é¹¿é‡éƒ": "è¨€ã„æ–¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™",

    "ã‚ã»": "æ³¨æ„ãŒå¿…è¦ã§ã™",
    "ã‚¢ãƒ›": "æ³¨æ„ãŒå¿…è¦ã§ã™",
    "é˜¿å‘†": "æ³¨æ„ãŒå¿…è¦ã§ã™",

    # ===== ããç³» =====
    "ãã": "æ®‹å¿µ",
    "ã‚¯ã‚½": "æ®‹å¿µ",
    "ç³": "æ®‹å¿µ",
    "ããã£ãŸã‚Œ": "å›°ã‚Šã¾ã—ãŸ",
    "ã‚¯ã‚½ãƒƒã‚¿ãƒ¬": "å›°ã‚Šã¾ã—ãŸ",

    # ===== æ„Ÿæƒ…çš„è¡¨ç¾ =====
    "ã¡ãã—ã‚‡ã†": "å›°ã£ãŸãª",
    "ãƒã‚¯ã‚·ãƒ§ã‚¦": "å›°ã£ãŸãª",
    "ç•œç”Ÿ": "å›°ã£ãŸãª",

    "ãµã–ã‘ã‚‹ãª": "ã‚„ã‚ã¦ãã ã•ã„",
    "ãƒ•ã‚¶ã‚±ãƒ«ãƒŠ": "ã‚„ã‚ã¦ãã ã•ã„",
    "ãµã–ã‘ã‚“ãª": "ã‚„ã‚ã¦",
    "ãƒ•ã‚¶ã‚±ãƒ³ãƒŠ": "ã‚„ã‚ã¦",

    # ===== å‘½ä»¤ãƒ»æš´è¨€ =====
    "ã—ã­": "ãã®è¨€è‘‰ã¯æ§ãˆã¦ãã ã•ã„",
    "ã‚·ãƒ": "ãã®è¨€è‘‰ã¯æ§ãˆã¦ãã ã•ã„",
    "æ­»ã­": "ãã®è¨€è‘‰ã¯æ§ãˆã¦ãã ã•ã„",

    "ããŸã°ã‚Œ": "ä¸é©åˆ‡ãªè¡¨ç¾ã§ã™",
    "ã‚¯ã‚¿ãƒãƒ¬": "ä¸é©åˆ‡ãªè¡¨ç¾ã§ã™",

    "æ¶ˆãˆã‚": "ãã®è¡¨ç¾ã¯æ§ãˆã¦ãã ã•ã„",
    "ããˆã‚": "ãã®è¡¨ç¾ã¯æ§ãˆã¦ãã ã•ã„",
    "ã‚­ã‚¨ãƒ­": "ãã®è¡¨ç¾ã¯æ§ãˆã¦ãã ã•ã„",

    "ã©ã‘": "ã™ã¿ã¾ã›ã‚“ã€ã©ã„ã¦ãã ã•ã„",
    "ãƒ‰ã‚±": "ã™ã¿ã¾ã›ã‚“ã€ã©ã„ã¦ãã ã•ã„",

    # ===== å¨åœ§ãƒ»æ•µå¯¾ =====
    "ã“ã®ã‚„ã‚ã†": "è½ã¡ç€ã„ã¦ãã ã•ã„",
    "ã‚³ãƒãƒ¤ãƒ­ã‚¦": "è½ã¡ç€ã„ã¦ãã ã•ã„",
    "ã“ã®é‡éƒ": "è½ã¡ç€ã„ã¦ãã ã•ã„",

    # ===== å¦å®šãƒ»è¦‹ä¸‹ã— =====
    "æœ€ä½": "æ®‹å¿µã§ã™",
    "æœ€æ‚ª": "ã‚ã¾ã‚Šè‰¯ãã‚ã‚Šã¾ã›ã‚“",
    "ã‚¯ã‚º": "å¥½ã¾ã—ããªã„è¡Œå‹•ã§ã™",
    "ããš": "å¥½ã¾ã—ããªã„è¡Œå‹•ã§ã™",
    "ã‚´ãƒŸ": "é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“",
    "ã”ã¿": "é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“",

    # ===== ä¸å¿«ãƒ»å«Œæ‚ª =====
    "ã†ã–ã„": "æ°—ã«ãªã‚Šã¾ã™",
    "ã‚¦ã‚¶ã‚¤": "æ°—ã«ãªã‚Šã¾ã™",
    "ãã‚‚ã„": "å¥½ã¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“",
    "ã‚­ãƒ¢ã‚¤": "å¥½ã¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“",
    "æ°—æŒã¡æ‚ªã„": "å¥½ã¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“",

    # ===== ä¹±æš´ãªå¦å®š =====
    "ã‚ã‚Šãˆãªã„": "é©šãã¾ã—ãŸ",
    "ã‚€ã‹ã¤ã": "ä¸å¿«ã«æ„Ÿã˜ã¾ã—ãŸ",
    "ãƒ ã‚«ãƒ„ã‚¯": "ä¸å¿«ã«æ„Ÿã˜ã¾ã—ãŸ",

    # ===== å‘½ä»¤ãƒ»æ’é™¤ =====
    "é»™ã‚Œ": "ç™ºè¨€ã‚’æ§ãˆã¦ãã ã•ã„",
    "ã ã¾ã‚Œ": "ç™ºè¨€ã‚’æ§ãˆã¦ãã ã•ã„",
    "ãƒ€ãƒãƒ¬": "ç™ºè¨€ã‚’æ§ãˆã¦ãã ã•ã„",
    "å¤±ã›ã‚": "é›¢ã‚Œã¦ãã ã•ã„",
    "å¸°ã‚Œ": "ä»Šæ—¥ã¯ã“ã“ã¾ã§ã«ã—ã¾ã—ã‚‡ã†",

    # ===== äººæ ¼å¦å®š =====
    "ç„¡èƒ½": "æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™",
    "å½¹ç«‹ãŸãš": "æœŸå¾…é€šã‚Šã§ã¯ã‚ã‚Šã¾ã›ã‚“",
    "é ­ãŠã‹ã—ã„": "è€ƒãˆæ–¹ãŒç‹¬ç‰¹ã§ã™",
    "é ­ãŒæ‚ªã„": "ç†è§£ã«æ™‚é–“ãŒå¿…è¦ã§ã™",
    "æ€§æ ¼æ‚ªã„": "èª¤è§£ã‚’æ‹›ãã‚„ã™ã„ã§ã™",

    # ===== ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚° =====
    "ks": "æ®‹å¿µã§ã™",
    "KY": "é…æ…®ãŒè¶³ã‚Šãªã„ã‚ˆã†ã§ã™",
    "disã‚‹": "æ‰¹åˆ¤ã™ã‚‹",
    "ãƒ‡ã‚£ã‚¹ã‚‹": "æ‰¹åˆ¤ã™ã‚‹",
    "è‰": "å°‘ã—é¢ç™½ã„ã§ã™ã­",
    "ï½—ï½—ï½—": "ï¼ˆç¬‘ï¼‰",

    # ===== å˜²ç¬‘ãƒ»è»½è¦– =====
    "é›‘é­š": "çµŒé¨“ãŒæµ…ã„",
    "ã–ã“": "çµŒé¨“ãŒæµ…ã„",
    "ã‚¶ã‚³": "çµŒé¨“ãŒæµ…ã„",
    "ã¤ã¾ã‚‰ãªã„": "èˆˆå‘³ã‚’æŒã¦ã¾ã›ã‚“ã§ã—ãŸ",
    "ç¬‘ãˆãªã„": "ã‚ã¾ã‚Šé¢ç™½ãã‚ã‚Šã¾ã›ã‚“",

    # ===== ãã®ä»– =====
    "ãªã‚ã¦ã‚‹": "è»½ãè¦‹ã¦ã„ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã¾ã™",
    "èª¿å­ã«ä¹—ã‚‹ãª": "è½ã¡ç€ã„ã¦ãã ã•ã„",
}

# ===============================
# å¤‰æ›é–¢æ•°
# ===============================
def convert_text(text: str) -> str:
    result = text
    for bad, good in replace_dict.items():
        result = result.replace(bad, good)
    return result

# ===============================
# UI
# ===============================
input_text = st.text_area("æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", height=160)

if st.button("å¤‰æ›ã™ã‚‹"):
    if input_text.strip() == "":
        st.warning("æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    else:
        output_text = convert_text(input_text)

        # Supabase ã«ä¿å­˜
        supabase.table("app_logs").insert({
            "input_text": input_text,
            "output_text": output_text,
            "created_at": datetime.now().isoformat()
        }).execute()

        st.success("å¤‰æ›çµæœ")
        st.write(output_text)

# ===============================
# å±¥æ­´è¡¨ç¤º
# ===============================
st.subheader("ğŸ“Š åˆ©ç”¨å±¥æ­´ï¼ˆæœ€æ–°10ä»¶ï¼‰")

response = (
    supabase.table("app_logs")
    .select("*")
    .order("created_at", desc=True)
    .limit(10)
    .execute()
)

for row in response.data:
    st.markdown(
        f"""
**æ—¥æ™‚**ï¼š{row["created_at"]}  
**å…¥åŠ›**ï¼š{row["input_text"]}  
**å‡ºåŠ›**ï¼š{row["output_text"]}  
---
"""
    )
